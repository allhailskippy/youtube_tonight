/**
 * @ngdoc controller
 * @name IndexCtrl
 *
 * @description Controller for the video player
 */
(function() {
  "use strict";

var IndexCtrl = function(
  $scope, $window,
  Video
  ) {
  /**
   * Setup
   */
  $scope.currentVideo = null;

  // Setup
  $scope.dispatcher = new WebSocketRails('localhost:3000/websocket');
  $scope.channel = $scope.dispatcher.subscribe('video_player');

  // Notify once conection's been established
  $scope.dispatcher.on_open = function(data) {
    // TODO: Notify that player is ready
  };

  /**
   * Scope Methods
   */
  // Wait for notice to play video
  $scope.channel.bind('play', function(message) {
    Video.find(message.video_id).then(function(response) {
      $scope.currentVideo = Video.build(response.data);
    });
    console.log(message);
  })

  // Pause the video
  $scope.channel.bind('pause', function() {
  });

  $window.onYouTubeIframeAPIReady = function() {
    console.log("READY!!!");
  };
};

IndexCtrl.$inject = [
  '$scope', '$window',
  'Video'
];

angular.module("PlayerApp")
       .controller('IndexCtrl', IndexCtrl);
}());
