/**
 * @ngdoc controller
 * @name UsersFormCtrl
 *
 * @description Logic for index stuffs
 */
(function() {
  "use strict";

var UsersFormCtrl = function(
  $scope, $routeParams, $location,
  User, Notice,
  user_data
  ) {

  /**
   * Setup
   */
  $scope.user = User.build(user_data.data);

  // Handle error response from server side
  var handleErrors = function(response) {
    Notice.handleErrors(response);
  };

  /**
   * Scope methods
   */
  $scope.cancel= function() {
    $location.path('/users/index');
  };

  $scope.destroy = function() {
    if(confirm('This will remove the user from the system\nThis cannot be undone!')) {
      $scope.user.destroy().then(function() {
        $location.path('/users/index');
      });
    };
  }

  $scope.save = function() {
    // We update the roles from here, so
    // let our model know to clear out
    // existing ones
    $scope.user.change_roles = true;
    $scope.user.save().then(function() {
      $location.path('/users/index');
    }).catch(handleErrors);
  };
};

UsersFormCtrl.$inject = [
  '$scope', '$routeParams', '$location',
  'User', 'Notice',
  'user_data'
];

angular.module("YTBroadcastApp")
       .controller('UsersFormCtrl', UsersFormCtrl);
}());
