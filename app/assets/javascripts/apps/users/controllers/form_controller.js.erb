/**
 * @ngdoc controller
 * @name FormCtrl
 *
 * @description Logic for index stuffs
 */
(function() {
  "use strict";

var FormCtrl = function(
  $scope, $routeParams, $location,
  UserApp, User, CurrentUser, Notice,
  current_user_data
  ) {

  /**
   * Setup
   */
  User.find($routeParams.id).then(function(response) {
    $scope.user = User.build(response.data);
  });

  $scope.currentUser = CurrentUser.build(current_user_data.data);

  // Handle error response from server side
  var handleErrors = function(response) {
    Notice.handleErrors(response);
  };

  /**
   * Scope methods
   */
  $scope.cancel= function() {
    $location.path('/index');
  };

  $scope.destroy = function() {
    if(confirm('This will remove the user from the system\nThis cannot be undone!')) {
      $scope.user.destroy().then(function() {
        $location.path('/index');
      });
    };
  }

  $scope.save = function() {
    // We update the roles from here, so
    // let our model know to clear out
    // existing ones
    $scope.user.change_roles = true;
    $scope.user.save().then(function() {
      $location.path('/index');
    }).catch(handleErrors);
  };
};

FormCtrl.$inject = [
  '$scope', '$routeParams', '$location',
  'UserApp', 'User', 'CurrentUser', 'Notice',
  'current_user_data'
];

angular.module("UserApp")
       .controller('FormCtrl', FormCtrl);
}());
