/**
 * @ngdoc controller
 * @name FormCtrl
 *
 * @description Logic for index stuffs
 */
(function() {
  "use strict";

var FormCtrl = function(
  $scope, $routeParams, $location,
  UserApp, User, CurrentUser, Playlist, Notice
  ) {

  /**
   * Setup
   */
  User.find($routeParams.id).then(function(response) {
    $scope.user = User.build(response.data);
  });

  CurrentUser.find().then(function(results) {
    $scope.currentUser = CurrentUser.build(results.data);
  });

  /**
   * Scope methods
   */
  $scope.cancel= function() {
    $location.path('/index');
  };

  $scope.destroy = function() {
    if(confirm('This will remove the user from the system\nThis cannot be undone!')) {
      $scope.user.destroy().then(function() {
        $location.path('/index');
      });
    };
  }

  // Trigger the import request for users playlists
  $scope.importPlaylists = function() {
    var list = Playlist.build({})
    list.importPlaylists().then(function(response) {
      Notice.setSuccesses(['Import has been successfully started but may take some time to complete']);
    }).catch(Notice.handleErrors);

  };

  $scope.save = function() {
    // We update the roles from here, so
    // let our model know to clear out
    // existing ones
    $scope.user.change_roles = true;
    $scope.user.save().then(function() {
      $location.path('/index');
    });
  };
};

FormCtrl.$inject = [
  '$scope', '$routeParams', '$location',
  'UserApp', 'User', 'CurrentUser', 'Playlist', 'Notice'
];

angular.module("UserApp")
       .controller('FormCtrl', FormCtrl);
}());
